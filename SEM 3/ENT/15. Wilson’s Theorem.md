## 1. Preliminaries

We work with congruences modulo a positive integer $n$.

### 1.1 Basic definitions

- `$a \equiv b \pmod{n}$` means $n$ divides $a-b$.
- If $\gcd(a,n)=1$, we say **$a$ has an inverse modulo $n$**: there exists an integer $a^{-1}$ such that
  $$
  aa^{-1} \equiv 1 \pmod{n}.
  $$

When $p$ is prime, every $a$ with $1\le a\le p-1$ is coprime to $p$, so each has a unique inverse modulo $p$.

### 1.2 Factorial

For integer $m\ge1$,
$$
m! = 1\cdot2\cdot3\cdots m.
$$

We will study $(p-1)!$ modulo $p$.

---

## 2. Wilson’s Theorem (forward direction)

**Theorem (Wilson).**  
If $p$ is prime, then
$$
(p-1)! \equiv -1 \pmod{p}.
$$

We prove this from the ground up.

### 2.1 Small primes

- For $p=2$: $(p-1)! = 1! = 1 \equiv -1 \pmod{2}$ (since $1\equiv -1$ mod $2$).
- For $p=3$: $(p-1)! = 2! = 2 \equiv -1 \pmod{3}$.

So the theorem holds for $p=2,3$.
Now assume $p>3$ prime.

### 2.2 Inverses modulo $p$ and self-inverse elements

For each $a$ with $1\le a\le p-1$ there is a unique inverse $a^{-1}$ (mod $p$) such that
$$
aa^{-1} \equiv 1 \pmod{p}.
$$

Call $a$ **self-inverse** if
$$
a \equiv a^{-1} \pmod{p}.
$$

Then
$$
a^2 \equiv 1 \pmod{p}
\iff
p \mid a^2-1 = (a-1)(a+1).
$$

Because $p$ is prime, this implies $p\mid(a-1)$ or $p\mid(a+1)$, so

$$
a \equiv 1 \pmod{p} \quad\text{or}\quad a \equiv -1 \pmod{p}.
$$

Within $\{1,2,\dots,p-1\}$ the only self-inverse elements are
$$
1 \quad\text{and}\quad p-1\equiv -1.
$$

All other $a$ satisfy $a^{-1}\not\equiv a$ and so occur in **distinct pairs** $(a,a^{-1})$.

### 2.3 Pairing argument

Look at the product
$$
(p-1)! = 1\cdot2\cdot\ldots\cdot(p-1)
$$
modulo $p$.

Group the factors as:

- the two self-inverse elements: $1$ and $p-1$;
- all remaining elements arranged in pairs $(a, a^{-1})$ with $a\not\equiv a^{-1}$.

For each such pair,
$$
a\cdot a^{-1} \equiv 1 \pmod{p}.
$$

So the product of all non-self-inverse elements is congruent to $1$.

Thus:
$$
(p-1)! \equiv 1 \cdot (p-1) \cdot 1 \equiv -1 \pmod{p}.
$$

That is Wilson’s theorem. ▢

---

## 3. Converse of Wilson’s Theorem

**Claim.**  
If $n>1$ and
$$
(n-1)! \equiv -1 \pmod{n},
$$
then $n$ is prime.

**Proof.**

Assume, for contradiction, that $n$ is composite.
Then $n=ab$ for some integers $a,b$ with $1<a,b<n$.

Both $a$ and $b$ are among $1,2,\dots,n-1$, so both divide $(n-1)!$.
Hence their product $ab=n$ divides $(n-1)!$:

$$
n \mid (n-1)!.
$$

So modulo $n$ we must have
$$
(n-1)! \equiv 0 \pmod{n}.
$$

But the assumption says $(n-1)! \equiv -1 \pmod{n}$.
Both cannot hold, so contradiction.

Therefore $n$ cannot be composite; $n$ is prime. ▢

**Conclusion.**

For $n>1$:
$$
\boxed{n \text{ is prime } \iff (n-1)! \equiv -1 \pmod{n}.}
$$

This is an exact primality criterion (beautiful, but computationally inefficient).

---

## 4. Behaviour for composite $n$

From the converse proof we essentially used:

If $n$ is composite and $n=ab$ with $1<a,b<n$, then both $a,b$ divide $(n-1)!$ so $n\mid (n-1)!$ and

$$
(n-1)! \equiv 0 \pmod{n}.
$$

This is true for all composite $n>4$.
(For $n=4$, $3! = 6 \equiv 2 \pmod{4}$, so special and harmless.)

So:

- For prime $n$: $(n-1)! \equiv -1 \pmod{n}$.
- For most composite $n$: $(n-1)! \equiv 0 \pmod{n}$.

This sharp contrast underlies the converse.

---

## 5. Application: solving $x^2 \equiv -1 \pmod{p}$

Your notes connect Wilson’s theorem with when $-1$ is a quadratic residue.

**Theorem.**  
For an odd prime $p$, the congruence
$$
x^2 \equiv -1 \pmod{p}
$$
has an integer solution if and only if
$$
p \equiv 1 \pmod{4}.
$$

### 5.1 Necessity: if solution exists, then $p\equiv1\pmod4$

Assume there is $x$ with $x^2 \equiv -1 \pmod{p}$.

Raise both sides to the power $(p-1)/2$:

Left side:
$$
(x^2)^{(p-1)/2} = x^{p-1}.
$$

Right side:
$$
(-1)^{(p-1)/2}.
$$

By Fermat’s Little Theorem, $x^{p-1} \equiv 1 \pmod{p}$.
So
$$
1 \equiv (-1)^{(p-1)/2} \pmod{p}.
$$

Since the right side is just $\pm 1$ as an integer, this forces
$$
(-1)^{(p-1)/2} = 1,
$$
so $(p-1)/2$ is even, hence
$$
p \equiv 1 \pmod{4}.
$$

### 5.2 Sufficiency: if $p\equiv1\pmod4$, construct a solution

Now assume $p$ is an odd prime with
$$
p = 4k + 1.
$$

We will use Wilson’s theorem to find an $x$ with $x^2\equiv-1$.

Start from
$$
(p-1)! \equiv -1 \pmod{p}.
$$

Write $(p-1)!$ as product of pairs:

Numbers $1,2,\dots,p-1$ can be paired as
$$
1\cdot(p-1),\ 2\cdot(p-2),\ \dots,\ \left(\frac{p-1}{2}\right)\cdot\left(\frac{p+1}{2}\right).
$$

Observe that for $1\le a\le \frac{p-1}{2}$,
$$
(p-a) \equiv -a \pmod{p}.
$$

So each pair product is
$$
a(p-a) \equiv a(-a) = -a^2 \pmod{p}.
$$

Thus:

$$
(p-1)! \equiv \prod_{a=1}^{(p-1)/2} (-a^2)
= (-1)^{(p-1)/2} \left(\prod_{a=1}^{(p-1)/2} a\right)^2
\pmod{p}.
$$

Now $(p-1)/2 = 2k$ is even (since $p=4k+1$), so
$$
(-1)^{(p-1)/2} = (-1)^{2k} = 1.
$$

Hence

$$
(p-1)! \equiv \left(\left(\frac{p-1}{2}\right)!\right)^2 \pmod{p}.
$$

But Wilson says $(p-1)! \equiv -1 \pmod{p}$, so we get

$$
\left(\left(\frac{p-1}{2}\right)!\right)^2 \equiv -1 \pmod{p}.
$$

Therefore
$$
x = \left(\frac{p-1}{2}\right)!
$$
is a solution of $x^2\equiv-1\pmod{p}$.

Combining both directions:

$$
\boxed{
x^2\equiv-1\pmod{p} \text{ solvable } \iff p\equiv 1\pmod{4},\ p\text{ prime}.
}
$$

This is exactly the theorem developed in your notes under “quadratic congruence $x^2+1\equiv0$ mod $p$”.

---

## 6. Example: using Wilson to evaluate factorial mod $p$

**Example.** Show that $18! \equiv -1 \pmod{19}$.

Since $19$ is prime, Wilson gives
$$
18! = (19-1)! \equiv -1 \pmod{19}.
$$

Similarly, for prime $p$, $(p-1)! \equiv -1 \pmod{p}$ immediately.

If we want to combine two primes, say to work modulo $437=19\cdot23$, we can:

1. Use Wilson modulo each prime.
2. Use congruence manipulations to express $18!$ modulo $23$.
3. Combine via Chinese Remainder Theorem.

Your handwritten 437 example follows that pattern.

---

## 7. Example: divisibility from Wilson’s theorem

**Claim.** If $p$ is a prime and $a$ is any integer, then
$$
p \mid a^p + (p-1)!a
\quad\text{and}\quad
p \mid a^p (p-1)! + a.
$$

**Proof of the first.**

By Fermat’s Little Theorem:
$$
a^p \equiv a \pmod{p}.
$$

By Wilson:
$$
(p-1)! \equiv -1 \pmod{p}.
$$

Hence
$$
a^p + (p-1)!a \equiv a + (-1)a \equiv 0 \pmod{p}.
$$

So $p$ divides that sum.

The second is analogous:
$$
a^p(p-1)! + a \equiv a(-1) + a \equiv 0 \pmod{p}.
$$

This matches the exercise near the end of your notes.

---

## 8. Example: twin primes exercise outline

Your notes include:

> If $p$ and $p+2$ are twin primes, prove both $p$ and $p+2$ divide a certain expression built from $(p-1)!$.

The pattern is:

1. Apply Wilson to $p$:
   $$
   (p-1)! \equiv -1 \pmod{p}.
   $$
2. Apply Wilson to $p+2$:
   $$
   (p+1)! \equiv -1 \pmod{p+2}.
   $$
3. Relate $(p+1)!$ to $(p-1)!$:
   $$
   (p+1)! = (p+1)p(p-1)!.
   $$
4. Use the congruences to simplify $(p+1)!$ modulo $p+2$, and isolate a linear expression in $(p-1)!$ and $p$.
5. Show that this common expression is $0$ modulo both $p$ and $p+2$.

---
